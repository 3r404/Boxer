/*
 * Boxer [Formstone Library]
 * @author Ben Plum
 * @version 1.10.2
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(c){function G(a){g.formatter=H;return c(this).on("click.boxer",c.extend({},g,a||{}),w)}function w(b){h(b);var d=c(this),e=b.data.$object,f=d[0].attributes?d.attr("href")||"":"",l=f.toLowerCase().split("."),l=l[l.length-1],k=d.data("type")||"",m="image"==k||"jpeg"==l||"jpg"==l||"gif"==l||"png"==l||"data:image"==f.substr(0,10),n=-1<f.indexOf("youtube.com/embed")||-1<f.indexOf("player.vimeo.com/video"),q="url"==k||!m&&!n&&"http"==f.substr(0,4),r="element"==k||!m&&!n&&!q&&"#"==f.substr(0,1), s="undefined"!==typeof e;if(1>c("#boxer").length&&(m||n||q||r||s)){a={$window:c(window),$body:c("body"),$target:d,$object:e,visible:!1,resizeTimer:null,touchTimer:null,gallery:{active:!1},options:b.data,isMobile:(I||b.data.mobile)&&!r};a.type=m?"image":n?"video":"element";if(m||n)b=a.$target.attr("rel"),"undefined"!==typeof b&&!1!==b&&(a.gallery.active=!0,a.gallery.rel=b,a.gallery.$items=c("a[rel= "+a.gallery.rel+"]"),a.gallery.index=a.gallery.$items.index(a.$target),a.gallery.total=a.gallery.$items.length- 1);b="";a.isMobile||(b+='<div id="boxer-overlay" class="'+a.options.customClass+'" style="opacity: 0"></div>');b+='<div id="boxer" class="loading '+a.options.customClass;a.isMobile&&(b+=" mobile");q&&(b+=" iframe");if(r||s)b+=" inline";b+='" style="opacity: 0;';!0===a.options.fixed&&(b+=" position: fixed;");b=b+'">'+('<span class="boxer-close">'+a.options.labels.close+"</span>");b+='<div class="boxer-container" style="';b=a.isMobile?b+"height: 100%; width: 100%":b+("height: "+a.options.height+"px; width: "+ a.options.width+"px");b+='">';b+='<div class="boxer-content" style="opacity: 0;">';if(m||n)b+='<div class="boxer-meta">',a.gallery.active?(b+='<div class="boxer-arrow previous">'+a.options.labels.previous+"</div>",b+='<div class="boxer-arrow next">'+a.options.labels.next+"</div>",b+='<p class="boxer-position"',1>a.gallery.total&&(b+=' style="display: none;"'),b+=">",b+='<span class="current">'+(a.gallery.index+1)+"</span> "+a.options.labels.count+' <span class="total">'+(a.gallery.total+1)+"</span>", b+="</p>",b+='<div class="boxer-caption gallery">'):b+='<div class="boxer-caption">',b+=a.options.formatter.apply(a.$body,[a.$target]),b+="</div></div>";b+="</div></div></div>";a.$body.append(b);a.$overlay=c("#boxer-overlay");a.$boxer=c("#boxer");a.$container=a.$boxer.find(".boxer-container");a.$content=a.$boxer.find(".boxer-content");a.$meta=a.$boxer.find(".boxer-meta");a.$position=a.$boxer.find(".boxer-position");a.$caption=a.$boxer.find(".boxer-caption");a.$arrows=a.$boxer.find(".boxer-arrow"); a.$animatables=c("#boxer-overlay, #boxer, .boxer-container");a.paddingVertical=parseInt(a.$boxer.css("paddingTop"),10)+parseInt(a.$boxer.css("paddingBottom"),10);a.paddingHorizontal=parseInt(a.$boxer.css("paddingLeft"),10)+parseInt(a.$boxer.css("paddingRight"),10);J();a.gallery.active&&x();a.$window.on("resize.boxer",p.resize).on("keydown.boxer",K);a.$body.on("touchstart.boxer click.boxer","#boxer-overlay, #boxer .boxer-close",y).on("touchmove.boxer",h);if(a.gallery.active)a.$boxer.on("touchstart.boxer click.boxer", ".boxer-arrow",L);a.$overlay.stop().animate({opacity:a.options.opacity},a.options.duration);a.$boxer.stop().animate({opacity:1},a.options.duration,function(){if(m)z(f);else if(n)A(f);else if(q){var b=f,b=b+(-1<b.indexOf("?")?"&"+g.requestKey+"=true":"?"+g.requestKey+"=true"),b=c('<iframe class="boxer-iframe" src="'+b+'" />');t(b)}else r?(b=c(f).find(">:first-child").clone(),t(b)):s?t(a.$object):c.error("BOXER: '"+f+"' is not valid.")})}if(s)return a.$boxer}function u(){if(a.isMobile)var b=0,d=0;else{var b= (a.$window.width()-a.contentWidth-a.paddingHorizontal)/2,d=0>=a.options.top?(a.$window.height()-a.contentHeight-a.paddingVertical)/2:a.options.top,e=a.$arrows.outerHeight();!0!==a.options.fixed&&(d+=a.$window.scrollTop());a.$arrows.css({marginTop:(a.contentHeight-a.metaHeight-e)/2})}e=a.isMobile?0:a.options.duration;if(!a.visible&&a.isMobile&&a.gallery.active)a.$content.on("touchstart.boxer",".boxer-image",M);(a.isMobile||a.options.fixed)&&a.$body.addClass("boxer-open");a.$boxer.stop().animate({left:b, top:d},e);a.$container.show().stop().animate({height:a.containerHeight,width:a.containerWidth},e,function(b){a.$content.stop().animate({opacity:1},a.options.duration);a.$boxer.removeClass("loading").find(".boxer-close").stop().animate({opacity:1},a.options.duration);a.visible=!0;a.options.callback.apply(a.$boxer);a.$window.trigger("boxer.open");a.gallery.active&&(b="",0<a.gallery.index&&(b=a.gallery.$items.eq(a.gallery.index-1).attr("href"),0>b.indexOf("youtube.com/embed")&&0>b.indexOf("player.vimeo.com/video")&& c('<img src="'+b+'">')),a.gallery.index<a.gallery.total&&(b=a.gallery.$items.eq(a.gallery.index+1).attr("href"),0>b.indexOf("youtube.com/embed")&&0>b.indexOf("player.vimeo.com/video")&&c('<img src="'+b+'">')))})}function y(b){h(b);"undefined"!==typeof a.$animatables&&(a.$animatables.stop().animate({opacity:0},a.options.duration,function(){c(this).remove()}),k(a.resizeTimer),a.$window.off(".boxer"),a.$body.off(".boxer").removeClass("boxer-open"),a.gallery.active&&a.$boxer.off(".boxer"),a.isMobile&& "image"==a.type&&a.gallery.active&&a.$container.off(".boxer"),a.$window.trigger("boxer.close"),a={})}function J(){if(a.isMobile)var b=0,d=0;else b=(a.$window.width()-a.$boxer.width()-a.paddingHorizontal)/2,d=0>=a.options.top?(a.$window.height()-a.$boxer.height()-a.paddingVertical)/2:a.options.top,!0!==a.options.fixed&&(d+=a.$window.scrollTop());a.$boxer.css({left:b,top:d})}function z(b){a.$image=c("<img />");a.$image.one("load.boxer",function(){var b;b=a.$image[0];var c=new Image;"undefined"!=typeof b.naturalHeight? b={naturalHeight:b.naturalHeight,naturalWidth:b.naturalWidth}:"img"===b.tagName.toLowerCase()?(c.src=b.src,b={naturalHeight:c.height,naturalWidth:c.width}):b=!1;a.naturalHeight=b.naturalHeight;a.naturalWidth=b.naturalWidth;a.options.retina&&(a.naturalHeight/=2,a.naturalWidth/=2);a.$content.prepend(a.$image);""==a.$caption.html()?a.$caption.hide():a.$caption.show();v(0)&&u()}).attr("src",b).addClass("boxer-image");(a.$image[0].complete||4===a.$image[0].readyState)&&a.$image.trigger("load")}function A(b){a.$videoWrapper= c('<div class="boxer-video-wrapper" />');a.$video=c('<iframe class="boxer-video" />');a.$video.attr("src",b).addClass("boxer-video").prependTo(a.$videoWrapper);a.$content.prepend(a.$videoWrapper);B();u()}function H(a){a=a.attr("title");return""!=a&&void 0!==a?'<p class="caption">'+a+"</p>":""}function v(b){a.windowHeight=a.viewportHeight=0==b?a.$window.height():a.windowHeight;a.windowWidth=a.viewportWidth=0==b?a.$window.width():a.windowWidth;a.imageHeight=0==b?a.naturalHeight:a.$image.outerHeight(); a.imageWidth=0==b?a.naturalWidth:a.$image.outerWidth();a.metaHeight=0==b?0:a.metaHeight;0==b&&(a.ratioHorizontal=a.imageHeight/a.imageWidth,a.ratioVertical=a.imageWidth/a.imageHeight,a.isWide=a.imageWidth>a.imageHeight);a.imageHeight<a.options.minHeight&&(a.options.minHeight=a.imageHeight);a.imageWidth<a.options.minWidth&&(a.options.minWidth=a.imageWidth);a.isMobile?(a.containerHeight=a.viewportHeight-a.paddingVertical,a.containerWidth=a.viewportWidth-a.paddingHorizontal,a.contentHeight=a.containerHeight- a.metaHeight,a.contentWidth=a.containerWidth,a=C(a),a.imageMarginTop=(a.contentHeight-a.targetImageHeight)/2,a.imageMarginLeft=(a.contentWidth-a.targetImageWidth)/2):(a.viewportHeight-=a.options.margin+a.paddingVertical+a.metaHeight,a.viewportWidth-=a.options.margin+a.paddingHorizontal,a=C(a),a.containerHeight=a.contentHeight=a.targetImageHeight,a.containerWidth=a.contentWidth=a.targetImageWidth,a.imageMarginTop=0,a.imageMarginLeft=0);a.$content.css({height:a.isMobile?a.contentHeight:"auto",width:a.contentWidth}); a.$meta.css({width:a.contentWidth});a.$image.css({height:a.targetImageHeight,width:a.targetImageWidth,marginTop:a.imageMarginTop,marginLeft:a.imageMarginLeft});a.metaHeight=a.$meta.outerHeight(!0);a.contentHeight+=a.metaHeight;a.isMobile||(a.containerHeight+=a.metaHeight);return a.contentHeight>a.viewportHeight&&2>b?v(b+1):!0}function C(a){var d=a.isMobile?a.contentHeight-a.options.margin:a.viewportHeight,c=a.isMobile?a.contentWidth-a.options.margin:a.viewportWidth;a.isWide?(a.targetImageWidth=c, a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal,a.targetImageHeight>d&&(a.targetImageHeight=d,a.targetImageWidth=a.targetImageHeight*a.ratioVertical)):(a.targetImageHeight=d,a.targetImageWidth=a.targetImageHeight*a.ratioVertical,a.targetImageWidth>c&&(a.targetImageWidth=c,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal));if(a.targetImageWidth>a.imageWidth||a.targetImageHeight>a.imageHeight)a.targetImageWidth=a.imageWidth,a.targetImageHeight=a.imageHeight;if(a.targetImageWidth<a.options.minWidth|| a.targetImageHeight<a.options.minHeight)a.targetImageWidth<a.options.minWidth?(a.targetImageWidth=a.options.minWidth,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal):(a.targetImageHeight=a.options.minHeight,a.targetImageWidth=a.targetImageHeight*a.ratioVertical);return a}function B(){a.windowHeight=a.$window.height()-a.paddingVertical;a.windowWidth=a.$window.width()-a.paddingHorizontal;a.videoMarginTop=0;a.videoMarginLeft=0;a.isMobile?(a.$meta.css({width:a.windowWidth}),a.metaHeight=a.$meta.outerHeight(!0), a.contentHeight=a.windowHeight,a.contentWidth=a.windowWidth,a.videoWidth=a.windowWidth,a.videoHeight=a.videoWidth*a.options.videoRatio,a.videoHeight>a.windowHeight-a.metaHeight&&(a.videoHeight=a.windowHeight-a.metaHeight,a.videoWidth=a.videoHeight*a.options.videoRatio),a.videoMarginTop=(a.contentHeight-a.videoHeight)/2,a.videoMarginLeft=(a.contentWidth-a.videoWidth)/2):(a.windowHeight-=a.options.margin,a.windowWidth-=a.options.margin,a.videoWidth=a.options.videoWidth>a.windowWidth?a.windowWidth:a.options.videoWidth, a.videoHeight=a.videoWidth*a.options.videoRatio,a.contentHeight=a.videoHeight,a.contentWidth=a.videoWidth);a.$content.css({height:a.isMobile?a.contentHeight:"auto",width:a.contentWidth});a.$meta.css({width:a.contentWidth});a.$videoWrapper.css({height:a.videoHeight,width:a.videoWidth,marginTop:a.videoMarginTop,marginLeft:a.videoMarginLeft});a.isMobile||(a.metaHeight=a.$meta.outerHeight(!0),a.contentHeight=a.videoHeight+a.metaHeight);a.containerHeight=a.contentHeight;a.containerWidth=a.contentWidth= a.videoWidth}function L(b){h(b);b=c(this);b.hasClass("disabled")||(a.$boxer.addClass("loading"),a.gallery.index+=b.hasClass("next")?1:-1,a.gallery.index>a.gallery.total&&(a.gallery.index=a.gallery.total),0>a.gallery.index&&(a.gallery.index=0),a.$content.stop().animate({opacity:0},a.options.duration,function(){"undefined"!==typeof a.$image&&a.$image.remove();"undefined"!==typeof a.$videoWrapper&&a.$videoWrapper.remove();a.$target=a.gallery.$items.eq(a.gallery.index);a.$caption.html(a.options.formatter.apply(a.$body, [a.$target]));a.$position.find(".current").html(a.gallery.index+1);var b=a.$target.attr("href");-1<b.indexOf("youtube.com/embed")||-1<b.indexOf("player.vimeo.com/video")?A(b):z(b);x()}))}function x(){a.$arrows.removeClass("disabled");0==a.gallery.index&&a.$arrows.filter(".previous").addClass("disabled");a.gallery.index==a.gallery.total&&a.$arrows.filter(".next").addClass("disabled")}function K(b){!a.gallery.active||37!=b.keyCode&&39!=b.keyCode?27==b.keyCode&&a.$boxer.find(".boxer-close").trigger("click"): (h(b),a.$arrows.filter(37==b.keyCode?".previous":".next").trigger("click"))}function t(b){a.$content.append(b);D(b);u()}function D(b){a.objectHeight=b.outerHeight(!0);a.objectWidth=b.outerWidth(!0);a.windowHeight=a.$window.height()-a.paddingVertical;a.windowWidth=a.$window.width()-a.paddingHorizontal;a.dataHeight=a.$target.data("height");a.dataWidth=a.$target.data("width");a.maxHeight=0>a.windowHeight?g.minHeight:a.windowHeight;a.isIframe=b.is("iframe");a.objectMarginTop=0;a.objectMarginLeft=0;a.isMobile|| (a.windowHeight-=a.options.margin,a.windowWidth-=a.options.margin);a.contentHeight=void 0!=a.dataHeight?a.dataHeight:a.isIframe?a.windowHeight:a.objectHeight;a.contentWidth=void 0!=a.dataWidth?a.dataWidth:a.isIframe?a.windowWidth:a.objectWidth;a.isIframe&&a.isMobile&&(a.contentHeight=a.windowHeight,a.contentWidth=a.windowWidth);a.containerHeight=a.contentHeight;a.containerWidth=a.contentWidth;a.$content.css({height:a.contentHeight,width:a.contentWidth})}function M(b){h(b);k(a.touchTimer);if(!a.isAnimating){var c= "undefined"!==typeof b.originalEvent.targetTouches?b.originalEvent.targetTouches[0]:null;a.xStart=c?c.pageX:b.clientX;a.leftPosition=0;a.touchMax=Infinity;a.touchMin=-Infinity;a.edge=0.25*a.contentWidth;0==a.gallery.index&&(a.touchMax=0);a.gallery.index==a.gallery.total&&(a.touchMin=0);a.$boxer.on("touchmove.boxer",N).one("touchend.boxer",E)}}function N(b){var c="undefined"!==typeof b.originalEvent.targetTouches?b.originalEvent.targetTouches[0]:null;a.delta=a.xStart-(c?c.pageX:b.clientX);20<a.delta&& h(b);a.canSwipe=!0;c=-a.delta;c<a.touchMin&&(c=a.touchMin,a.canSwipe=!1);c>a.touchMax&&(c=a.touchMax,a.canSwipe=!1);a.$image.css({transform:"translate3D("+c+"px,0,0)"});a.touchTimer=F(a.touchTimer,300,function(){E(b)})}function E(b){h(b);k(a.touchTimer);a.$boxer.off("touchmove.boxer touchend.boxer");a.delta&&(a.$boxer.addClass("animated"),a.swipe=!1,a.canSwipe&&(a.delta>a.edge||a.delta<-a.edge)?(a.swipe=!0,a.delta<=a.leftPosition?a.$image.css({transform:"translate3D("+a.contentWidth+"px,0,0)"}):a.$image.css({transform:"translate3D("+ -a.contentWidth+"px,0,0)"})):a.$image.css({transform:"translate3D(0,0,0)"}),a.swipe&&a.$arrows.filter(a.delta<=a.leftPosition?".previous":".next").trigger("click"),F(a.resetTimer,a.options.duration,function(){a.$boxer.removeClass("animated")}))}function F(a,c,e){k(a);return setTimeout(e,c)}function k(a){a&&clearTimeout(a)}function h(a){a.preventDefault&&(a.stopPropagation(),a.preventDefault())}var g={callback:c.noop,customClass:"",duration:250,fixed:!1,formatter:c.noop,height:100,labels:{close:"Close", count:"of",next:"Next",previous:"Previous"},margin:100,minHeight:100,minWidth:100,mobile:!1,opacity:0.75,retina:!1,requestKey:"boxer",top:0,videoRatio:0.5625,videoWidth:600,width:100},a={},I=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||window.opera),p={defaults:function(a){g=c.extend(g,a||{});return c(this)},destroy:function(){y();return c(this).off(".boxer")},resize:function(b){if("undefined"!=typeof a.$boxer&&("element"==a.type?D(a.$content.find(">:first-child")): "image"==a.type?v(0):"video"==a.type&&B(),b=!1,a.visible)){if(a.isMobile)var d=0,e=0;else{var d=(a.$window.width()-a.contentWidth-a.paddingHorizontal)/2,e=0>=a.options.top?(a.$window.height()-a.contentHeight-a.paddingVertical)/2:a.options.top,f=a.$arrows.outerHeight();!0!==a.options.fixed&&(e+=a.$window.scrollTop());a.$arrows.css({marginTop:(a.contentHeight-a.metaHeight-f)/2})}b?(a.$boxer.stop().animate({left:d,top:e},a.options.duration),a.$container.show().stop().animate({height:a.containerHeight, width:a.containerWidth})):(a.$boxer.css({left:d,top:e}),a.$container.css({height:a.containerHeight,width:a.containerWidth}))}return c(this)}};c.fn.boxer=function(a){return p[a]?p[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:G.apply(this,arguments)};c.boxer=function(a,d){return p[a]?p[a].apply(window,Array.prototype.slice.call(arguments,1)):w(c.Event("click",{data:c.extend({$object:a},g,d||{})}))}})(jQuery);