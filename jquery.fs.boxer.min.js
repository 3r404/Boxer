/*
 * Boxer [Formstone Library]
 * @author Ben Plum
 * @version 1.7.0
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(c){function D(a){m.formatter=E;return c(this).on("touchstart.boxer click.boxer",c.extend({},m,a||{}),s)}function s(b){b.preventDefault();b.stopPropagation();var d=c(this),t=b.data.$object,e=d[0].attributes?d.attr("href")||"":"",l=e.toLowerCase().split("."),l=l[l.length-1],f=d.data("type")||"",h="image"==f||"jpeg"==l||"jpg"==l||"gif"==l||"png"==l||"data:image"==e.substr(0,10),k=-1<e.indexOf("youtube.com/embed")||-1<e.indexOf("player.vimeo.com/video"),p="url"==f||!h&&!k&&"http"==e.substr(0, 4),g="element"==f||!h&&!k&&!p&&"#"==e.substr(0,1),q="undefined"!==typeof t;if(1>c("#boxer").length&&(h||k||p||g||q)){a={$target:d,$object:t,gallery:{active:!1},options:b.data,isMobile:F&&!p&&!g&&!q};a.type=h?"image":k?"video":"element";if(h||k)b=a.$target.attr("rel"),"undefined"!==typeof b&&!1!==b&&(a.gallery.active=!0,a.gallery.rel=b,a.gallery.$items=c("a[rel= "+a.gallery.rel+"]"),a.gallery.index=a.gallery.$items.index(a.$target),a.gallery.total=a.gallery.$items.length-1);b="";a.isMobile||(b+='<div id="boxer-overlay" class="'+ a.options.customClass+'" style="opacity: 0"></div>');b+='<div id="boxer" class="'+a.options.customClass;a.isMobile&&(b+=" mobile");p&&(b+=" iframe");if(g||q)b+=" inline";b+='" style="opacity: 0;';!0===a.options.fixed&&(b+=" position: fixed;");b+='"><span class="boxer-close">Close</span>';b+='<div class="boxer-container" style="opacity: 0; height: '+a.options.height+"px; width: "+a.options.width+'px">';b+='<div class="boxer-content">';if(h||k)b+='<div class="boxer-meta">',a.gallery.active?(b+='<div class="boxer-arrow previous">Previous</div>', b+='<div class="boxer-arrow next">Next</div>',b+='<p class="boxer-position"',1>a.gallery.total&&(b+=' style="display: none;"'),b+=">",b+='<span class="current">'+(a.gallery.index+1)+'</span> of <span class="total">'+(a.gallery.total+1)+"</span>",b+="</p>",b+='<div class="boxer-caption gallery">'):b+='<div class="boxer-caption">',b+=a.options.formatter.apply(c("body"),[a.$target]),b+="</div></div>";b+="</div></div></div>";c("body").append(b);a.$overlay=c("#boxer-overlay");a.$boxer=c("#boxer");a.$container= a.$boxer.find(".boxer-container");a.$content=a.$boxer.find(".boxer-content");a.$meta=a.$boxer.find(".boxer-meta");a.$position=a.$boxer.find(".boxer-position");a.$caption=a.$boxer.find(".boxer-caption");a.$arrows=a.$boxer.find(".boxer-arrow");a.$animatables=c("#boxer-overlay, #boxer, .boxer-container");a.padding=2*parseInt(a.$boxer.css("paddingTop"),10);u();a.gallery.active&&v();c(window).on("resize.boxer",G).on("keydown.boxer",H);c("body").on("touchstart.boxer click.boxer","#boxer-overlay, #boxer .boxer-close", w);if(a.gallery.active)a.$boxer.on("touchstart.boxer click.boxer",".boxer-arrow",I);a.$overlay.stop().animate({opacity:a.options.opacity},a.options.duration);a.$boxer.stop().animate({opacity:1},a.options.duration,function(){if(h)x(e);else if(k)y(e);else if(p){var b=e,b=b+(-1<b.indexOf("?")?"&"+m.requestKey+"=true":"?"+m.requestKey+"=true"),b=c('<iframe class="boxer-iframe" src="'+b+'" />');n(b)}else g?(b=c(e).find(">:first-child").clone(),n(b)):q?n(a.$object):c.error("BOXER: '"+e+"' is not valid.")})}if(q)return a.$boxer} function g(){if(a.isMobile)var b=0,d=0;else{var b=(c(window).width()-a.contentWidth-a.padding)/2,d=0>=a.options.top?(c(window).height()-a.contentHeight-a.padding)/2:a.options.top,f=a.$arrows.outerHeight();!0!==a.options.fixed&&(d+=c(window).scrollTop());a.$arrows.css({marginTop:(a.contentHeight-a.metaHeight-f)/2})}a.$boxer.stop().animate({left:b,top:d},a.options.duration);a.$container.show().stop().animate({height:a.contentHeight,width:a.contentWidth},a.options.duration,function(b){a.$container.stop().animate({opacity:1}, a.options.duration);a.$boxer.find(".boxer-close").stop().animate({opacity:1},a.options.duration);a.options.callback.apply(a.$boxer)})}function w(b){b.preventDefault&&(b.preventDefault(),b.stopPropagation());"undefined"!==typeof a.$animatables&&(a.$animatables.stop().animate({opacity:0},a.options.duration,function(){c(this).remove()}),clearTimeout(f),f=null,c(window).off(".boxer"),c("body").off(".boxer"),a.gallery.active&&a.$boxer.off(".boxer"),a={})}function G(){a.isMobile||(null!==f&&(clearTimeout(f), f=null),f=setTimeout(function(){u()},10))}function u(){if(a.isMobile)var b=0,d=0;else b=(c(window).width()-a.$boxer.width()-a.padding)/2,d=0>=a.options.top?(c(window).height()-a.$boxer.height()-a.padding)/2:a.options.top,!0!==a.options.fixed&&(d+=c(window).scrollTop());a.$boxer.css({left:b,top:d})}function x(b){a.$image=c("<img />");a.$image.one("load.boxer",function(){a.naturalHeight=a.$image[0].naturalHeight;a.naturalWidth=a.$image[0].naturalWidth;a.options.retina&&(a.naturalHeight/=2,a.naturalWidth/= 2);a.$content.prepend(a.$image);""==a.$caption.html()?a.$caption.hide():a.$caption.show();r(0)&&g()}).attr("src",b).addClass("boxer-image");a.$image[0].complete&&a.$image.trigger("load")}function y(b){a.$videoWrapper=c('<div class="boxer-video-wrapper" />');a.$video=c('<iframe class="boxer-video" />');a.$video.attr("src",b).addClass("boxer-video").prependTo(a.$videoWrapper);a.$content.prepend(a.$videoWrapper);z();g()}function E(a){a=a.attr("title");return""!=a&&void 0!==a?'<p class="caption">'+a+ "</p>":""}function r(b){a.windowHeight=a.viewportHeight=0==b?c(window).height():a.windowHeight;a.windowWidth=a.viewportWidth=0==b?c(window).width():a.windowWidth;a.imageHeight=0==b?a.naturalHeight:a.$image.outerHeight();a.imageWidth=0==b?a.naturalWidth:a.$image.outerWidth();a.metaHeight=0==b?0:a.metaHeight;0==b&&(a.ratioHorizontal=a.imageHeight/a.imageWidth,a.ratioVertical=a.imageWidth/a.imageHeight,a.isWide=a.imageWidth>a.imageHeight);a.imageHeight<a.options.minHeight&&(a.options.minHeight=a.imageHeight); a.imageWidth<a.options.minWidth&&(a.options.minWidth=a.imageWidth);a.isMobile?(a.viewportHeight-=a.padding,a.viewportWidth-=a.padding,a.contentHeight=a.viewportHeight,a.contentWidth=a.viewportWidth,a=A(a),a.imageMarginTop=(a.contentHeight-a.targetImageHeight)/2,a.imageMarginLeft=(a.contentWidth-a.targetImageWidth)/2):(a.viewportHeight-=a.options.margin+a.padding+a.metaHeight,a.viewportWidth-=a.options.margin+a.padding,a=A(a),a.contentHeight=a.targetImageHeight,a.contentWidth=a.targetImageWidth,a.imageMarginTop= 0,a.imageMarginLeft=0);a.$content.css({height:a.isMobile?a.contentHeight:"auto",width:a.contentWidth});a.$meta.css({width:a.contentWidth});a.$image.css({height:a.targetImageHeight,width:a.targetImageWidth,marginTop:a.imageMarginTop,marginLeft:a.imageMarginLeft});return!a.isMobile&&(a.metaHeight=a.$meta.outerHeight(!0),a.contentHeight+=a.metaHeight,a.contentHeight>a.viewportHeight&&2>b)?r(b+1):!0}function A(a){a.isWide?(a.targetImageWidth=a.viewportWidth,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal, a.targetImageHeight>a.viewportHeight&&(a.targetImageHeight=a.viewportHeight,a.targetImageWidth=a.targetImageHeight*a.ratioVertical)):(a.targetImageHeight=a.viewportHeight,a.targetImageWidth=a.targetImageHeight*a.ratioVertical,a.targetImageWidth>a.viewportWidth&&(a.targetImageWidth=a.viewportWidth,a.targetImageHeight=a.targetImageWidth*a.ratioHorizontal));if(a.targetImageWidth>a.imageWidth||a.targetImageHeight>a.imageHeight)a.targetImageWidth=a.imageWidth,a.targetImageHeight=a.imageHeight;if(a.targetImageWidth< a.options.minWidth||a.targetImageHeight<a.options.minHeight)a.imageWidth>a.imageHeight?(a.targetImageHeight=a.options.minHeight,a.targetImageWidth=a.targetImageHeight*a.ratioHorizontal):(a.targetImageWidth=a.options.minWidth,a.targetImageHeight=a.tagretImageWidth*a.ratioVertical);return a}function z(){a.windowHeight=c(window).height()-a.padding;a.windowWidth=c(window).width()-a.padding;a.videoMarginTop=0;a.videoMarginLeft=0;a.isMobile?(a.$meta.css({width:a.windowWidth}),a.metaHeight=a.$meta.outerHeight(!0), a.contentHeight=a.windowHeight,a.contentWidth=a.windowWidth,a.videoWidth=a.windowWidth,a.videoHeight=a.videoWidth*a.options.videoRatio,a.videoHeight>a.windowHeight-a.metaHeight&&(a.videoHeight=a.windowHeight-a.metaHeight,a.videoWidth=a.videoHeight*a.options.videoRatio),a.videoMarginTop=(a.contentHeight-a.videoHeight)/2,a.videoMarginLeft=(a.contentWidth-a.videoWidth)/2):(a.windowHeight-=a.options.margin,a.windowWidth-=a.options.margin,a.videoWidth=a.options.videoWidth>a.windowWidth?a.windowWidth:a.options.videoWidth, a.videoHeight=a.videoWidth*a.options.videoRatio,a.contentHeight=a.videoHeight,a.contentWidth=a.videoWidth);a.$content.css({height:a.isMobile?a.contentHeight:"auto",width:a.contentWidth});a.$meta.css({width:a.contentWidth});a.$videoWrapper.css({height:a.videoHeight,width:a.videoWidth,marginTop:a.videoMarginTop,marginLeft:a.videoMarginLeft});a.isMobile||(a.metaHeight=a.$meta.outerHeight(!0),a.contentHeight=a.videoHeight+a.metaHeight);a.contentWidth=a.videoWidth}function I(b){b.preventDefault();b.stopPropagation(); b=c(this);b.hasClass("disabled")||(a.gallery.index+=b.hasClass("next")?1:-1,a.gallery.index>a.gallery.total&&(a.gallery.index=a.gallery.total),0>a.gallery.index&&(a.gallery.index=0),a.$container.stop().animate({opacity:0},a.options.duration,function(){"undefined"!==typeof a.$image&&a.$image.remove();"undefined"!==typeof a.$videoWrapper&&a.$videoWrapper.remove();a.$target=a.gallery.$items.eq(a.gallery.index);a.$caption.html(a.options.formatter.apply(c("body"),[a.$target]));a.$position.find(".current").html(a.gallery.index+ 1);var b=a.$target.attr("href");-1<b.indexOf("youtube.com/embed")||-1<b.indexOf("player.vimeo.com/video")?y(b):x(b);v()}))}function v(){a.$arrows.removeClass("disabled");0==a.gallery.index&&a.$arrows.filter(".previous").addClass("disabled");a.gallery.index==a.gallery.total&&a.$arrows.filter(".next").addClass("disabled")}function H(b){!a.gallery.active||37!=b.keyCode&&39!=b.keyCode?27==b.keyCode&&a.$boxer.find(".boxer-close").trigger("click"):(b.preventDefault(),b.stopPropagation(),a.$arrows.filter(37== b.keyCode?".previous":".next").trigger("click"))}function n(b){a.$content.append(b);B(b);g()}function B(b){var d=b.outerHeight(!0),f=b.outerWidth(!0),e=c(window).height()-a.options.margin-a.padding,g=c(window).width()-a.options.margin-a.padding,n=a.$target.data("height"),h=a.$target.data("width"),k=0>e?m.minHeight:e;b=b.is("iframe");a.contentHeight=void 0!=n?n:b?e:d;a.contentWidth=void 0!=h?h:b?g:f;a.contentHeight>k?(a.contentHeight=k,b||a.$content.css({overflowY:"scroll"})):a.$content.css({overflowY:"auto"}); a.$content.css({height:a.contentHeight,width:a.contentWidth})}var m={callback:c.noop,customClass:"",duration:250,fixed:!1,formatter:c.noop,height:100,margin:100,minHeight:200,minWidth:200,opacity:0.75,retina:!1,requestKey:"boxer",top:0,videoRatio:0.5625,videoWidth:600,width:100},a={},f=null,F=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||window.opera),C={destroy:function(){w();return c(this).off(".boxer")},resize:function(b,d,f){"undefined"!=typeof a.$boxer&& ("element"==a.type?B(a.$content.find(">:first-child")):"image"==a.type?r(1):"video"==a.type&&z(),g());return c(this)}};c.fn.boxer=function(a){return C[a]?C[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:D.apply(this,arguments)};c.boxer=function(a,d){return s(c.Event("click",{data:c.extend({$object:a},m,d||{})}))}})(jQuery);